# Outline

## Walls Have Ears - Trafﬁc-based Side-channel Attack in Video Streaming -  INFOCOM 2018

Created by : Mr Dk.

2019 / 02 / 07 04:21

Ningbo, Zhejiang, China

---

### Introduction

目前，在线视频流越来越受欢迎

_Cisco_ 预测，`2021` 年前视频流将会占据互联网流量的 `82%`

_Adaptive Bitrate Streaming (ABS) based on HTTP_ 成为视频流的主要市场技术

优势：

* 灵活性
* 基础设施友好

_ABS_ 通过将多个质量等级的视频分段，从而允许智能的客户端驱动比特率适配

_Dynamic Adaptive Streaming over HTTP (DASH)_ 是 _ABS_ 的一种代表性实现

尽管 _DASH_ 十分受欢迎，但其基于分段的传输带来了基于网络流量分析的侧信道攻击的风险

通常，一个视频先使用 _Variable Bit-Rate (VBR)_ 编码为多个质量等级的版本

之后，每个版本被切分为固定时间长度的段

在播放时，客户端向服务器请求特定质量等级的一个段

攻击者通过在监听网络流量

可以识别出特定的流量模式

与此同时，利用下载好的视频文件，可以构造一个视频指纹的集合

攻击者通过比较流量模式和视频指纹

可以推断出目前哪个视频正在被播放

基于流量的侧信道攻击已经被研究多年，在过去的研究中：

* 很难在实际环境中实行

本文提出对于 _DASH_ 视频流的侧信道攻击：

* 不需要视频流服务器上的元数据或内容数据
* 直接从视频文件本身提取视频指纹
* 直接从视频流的网络流量中计算模式
* 结合流量模式和视频指纹，进行有效的视频识别

挑战：

1. 视频被编码为多个质量等级；这些等级事先不知道，也不是固定的；因此很难生成稳定且有代表性的视频指纹
2. 在视频流播放期间，质量等级是根据网络状况自适配选择的；因此，同一个视频的网络流量展现出不确定的模式
3. 监听到的网络流量不一定对应一个完整的视频，可能只是视频的一部分

作者发现，虽然同一个视频在 _DASH_ 中有不同的质量等级

但是比特率的变化趋势相对稳定

因此作者使用一种基于比特率微分的方法，产生稳定的视频指纹

对于监听的视频流流量，作者提出方法将它们分区并聚合成段

然后将两个相邻段进行微分，产生有效的流量模式

最后，使用 _Partial Dynamic Time Warping (P-DTW)_ 的方法计算视频指纹和流量模式之间的相似性距离

* 此方法能够只使用一部分视频流流量的实现视频识别

本文的贡献：

1. 在不需要修改视频客户端和服务器的条件下，通过监听流量，获得视频身份
2. 提出了基于比特率微分的特征提取方法，产生稳定的视频指纹；当监听到的流量不完整时，设计了有效的局部匹配方法，结合视频指纹和流量特征，获得视频的身份
3. 实现了攻击方法，并用实际的视频流进行评估；识别能够在连续监听三分钟流量的条件下，取得高达 `90%` 的 accuracy

---

### Background and Motivation

#### Basics of DASH

在服务器端，视频被预处理：

* 编码为不同质量等级的版本
* 切分为段

基于 _HTTP_ 的 _DASH_ 可被视为一系列文件的传输

遵循经典的 `request-and-reply` 模型

最开始，客户端向服务器发送请求，获取一个描述文件，其中包含描述所有段及其所有质量等级的元数据

之后，客户端开始按需请求视频段

自适应比特率是客户端驱动的，根据网络状况动态调整

#### VBR Encoding

在服务器端，视频被编码为多个质量等级

有两种常用的编码模式：

* Constant Bit-Rate (CBR)
  * 输出数据以恒定的速率被消费
* Variable Bit-Rate (VBR)
  * 有特定的平均比特率约束
  * 根据媒体的复杂度，使视频每个时间槽的输出数据量变化

考虑到性能，VBR 被用于大部分的实际流服务中

平均比特率固定，每个时刻的比特率不同

观察发现：

即使是在不同的质量等级下，比特率的趋势遵循一个特定的模式

意味着可以用于视频识别

#### Traffic of DASH

作者播放了三个不同的视频

用相同的比特率编码，并切分为时间长度相同的段

_DASH_ 的网络流量意味着 __周期性的视频段下载__

因此，不同视频的流量行为有独立的模式

_DASH_ 存在以下三个特点，使其容易遭受攻击：

1. 由于分段传输的行为，它的流量模式与连续的数据传输行为相比会更明显
2. 传输的视频段是严格按照顺序的
3. 与网页不同，视频流有更长的生命周期；因此在一次会话中可以采集到足够的数据完成攻击

#### In Summary

虽然视频能够被编码为不同的质量等级

然而由于 VBR 的机制，比特率趋势是不变的

DASH 流遵循周期性的分段数据传输，因此网络流量会有各自独立的模式

通过监听网络流量来识别视频流是有可能的

挑战在于在视频比特率趋势和流量模式之间找到匹配方式

此外，由于 DASH 的动态适配特性

传输的视频流的段具有不同的质量等级，使流量模式不稳定

---

### Video Fingerprints and Traffic Patterns

#### Video Fingerprints

由于 _DASH_ 使用固定长度的视频分段

作者也基于分段的规则给视频采指纹

对于一个 `n` 秒的视频，计算每秒的数据量 `a = (a1, a2, ..., an)`

然而用这种简单的方法，不同的质量等级会导致不同的指纹

为了解决这个问题，引入了基于微分的方法

`ri = fdiff(ai, ai-1) = (ai - ai-1) / ai-1`

视频指纹表示为：`r = (r1, r2, ..., rn)`

#### Traffic Patterns

将 `t` 时刻每秒钟采集到的流量数据量表示为 `bt`

在 _DASH_ 中，网络流量主要包括两部分：

* 客户端请求新的一段视频
* 服务器将一段视频数据返回

前者的数据量与后者相比可以忽略不计

此外，_DASH_ 特定的 _MPD_ 文件需要在播放前传输，也可以被忽略

__因此，网络流量可被视为从服务器传输到客户端的视频数据量__

在 _DASH_ 中，段的长度表示用户消费一段视频段所用的时间，通常是固定的

段长度不严格对应于流量峰值，因为流量中没有段边界

当网络状况较差时，一个段的传输可能会导致几个连续的流量峰值

幸运的是，还有两个观测值可以信赖：

1. 一个视频段的长度被全局段长度限制；为了保证顺畅的视频体验，段的长度不会太长，所以一个段的传输不会需要很长时间
2. _DASH_ 的缓冲策略决定了播放器将保持下载数据直至缓冲区满；在稳定的视频流中，两次下载视频段中间的间隔基本上是固定的

基于这两个观察，作者提出了一个函数，将流量数据聚合到一个周期中

* `fper(bt, ε, τ)`
* 周期代表一个段完全被传输的时间范围
* `bt` 表示每秒的流量数据量
* `ε` 用于过滤非常小的数据量
* `τ` 表示一个周期能够覆盖的最大时间

通过计算，可以得到周期性的数据量序列 `p = (p1, p2, ..., pj)`

在流量聚合之后，数据传输的绝对时间信息被丢弃

---

### Video Identification

#### Video Fingerprinting

视频指纹 `r` 对应的时间单位是 `1s`

然而，数据传输是基于分段的，通常持续好几秒

因此视频指纹也应当被聚合成段

设段长度为一个常数 `L`

本质上，视频指纹就是将 `r` 的序列切分为块，每一块包含 `L` 的值

得到每秒数据量 `a` 关于 `r` 的表达式

每 `L` 秒的数据量相加，得到 `si = R(ri, L)a1`，表示第 `i` 个段的数据量之和

计算段之间的微分 `dfpi = fdiff(si, si-1)`

那么给定一个段长 `L` 和比特率趋势的序列 `r`

就能够计算出有效的视频指纹 `dfp = (dfp1, dfp2, ..., dfpj)`

#### Traffic Pattern Extraction

`pi` 代表第 `i` 个周期中的数据传输量

直接使用绝对的数据量来进行判断是不合理的

使用 `fdiff` 函数计算了每个周期之间的数据量微分 `dtri = fdiff(pi, pi-1)`

得到了稳定有效的通信模式 `dtr = (dtr1, dtr2, ..., dtrk)`

#### Similarity Measurement

在监听网络流量一段时间后，得到流量模式 `dtr`

与此同时，对于数据集中的每一个视频，计算出视频的指纹 `dfp`

视频识别的目的是为了找出哪一个视频最有可能产生得到的流量模式

因此需要计算 `dtr` 和每一个 `dfp` 的相似度，并进行比较

是一个经典的序列比较问题

解决序列匹配问题的方法有：

* Discrete Wavelet Transform (DWT)
* Discrete Fourier Transform (DFT)
* Dynamic Time Warping (DTW)
* Symbolic Aggregate Approximation (SAX)

然而在本文阐述的问题中，有两个特定不能被忽略：

* 流量测量值可能会比较少，因为监听只持续一小段时间，因此基于统计学的方法不可行
* 流量模式可能只对应整个视频中的一小部分，因此在相似性计算中必须考虑部分匹配

在进行相似性计算之前，需要把两个序列归一化到相同尺度 - _Z-normalization_

由于 `dtr` 的长度远小于 `dfp` 的长度，因此用全局的均值和标准差来归一化 `dtr` 是不合理的

因此，需要一个鲁棒性好、稳定的规范化模式 - _Sigmoid Function_

* 这个函数与全局统计值独立

经过变换，两个序列被规范化到 `(0, 1)`

使用 DTW 计算相似性

* 通过弯曲时间轴的方式对齐两个序列，找到它们之间的最优匹配
* 然而传统的 DTW 在计算累计成本时，代入了整个序列

因此，本文提出了 P-DTW 用于部分匹配

区别：

* 经典的 DTW 试图匹配两个序列中的每一个元素
* 在本文阐述的问题中，由于流量模式是视频指纹中的一小部分，因此应当是部分匹配；经典 DTW 在这里不够合理

将 `Dfp` 作为模板序列，将 `Dtr` 作为查询序列

P-DTW 的原则是在模板序列中找到一个和查询序列相似性距离最小的子序列

* _step pattern_

#### Video Identification

给定一个流量模式和一个包含 `n` 个视频的数据集

将会产生 `n` 个距离

应当设定一个阈值，使匹配的 pair 和未匹配的 pair 的区分度足够高

衡量三个因素：

* 监听时间
* 段长度
* 视频内容

经过评估：

* 匹配的 pair 的相似性距离显著得低于未匹配的 pair
* 随着监听时间的变化，匹配的 pair 的相似性距离维持稳定
* 当段长度变化时，匹配的 pair 的相似性距离全部低于未匹配的 pair
* 当视频内容变化时，匹配的 pair 的相似性距离全部保持稳定

因此，设定一个阈值是合理的

---

### Implementation and Evaluation

#### Experimental Settings

#### Evaluation of Similarity Measurement

#### Single-bitrate Streaming

识别准备率受段长度的显著影响

直观上来说，更小的段长度能揭露更多的识别信息

#### Multiple-bitrate Adaptive Streaming

比特率适配每分钟触发一次

当监听时间较短时，accuracy 略有下降

当监听时间达到 `180s` 时，accuracy 高达 `90%`

---

### Summary

这篇文章在数据处理这部分还是下了功夫的

而且没有用机器学习

有些数据处理的动机我还不是特别明白

不过基本上的思想是懂了

---

