# Outline

## RESTler: Stateful REST API Fuzzing - ICSE 2019

Created by : Mr Dk.

2019 / 09 / 09 14:55

Nanjing, Jiangsu, China

---

## Introduction

äº‘æœåŠ¡çš„å‡ ç§ç±»å‹ï¼š

* è½¯ä»¶åº”ç”¨ - Software-as-a-Service
* åˆ†å¸ƒå¼æœåŠ¡åŠæ•°æ®å¤„ç† - Platform-as-a-Service
* æä¾›è®¡ç®—åŸºç¡€è®¾æ–½ - Infrastructure-as-a-Service

å¤§éƒ¨åˆ†äº‘æœåŠ¡ä»¥ REST API çš„å½¢å¼è®¿é—®

ä½†ç›®å‰å°‘æœ‰ç”¨æˆ·è‡ªåŠ¨åŒ–æµ‹è¯• REST API çš„å·¥å…·

æœ¬æ–‡ä»‹ç»çš„ RESTler æ˜¯ç¬¬ä¸€æ¬¾è‡ªåŠ¨åŒ–çš„ REST API fuzzing å·¥å…·

* æ¯ä¸€æ¬¡çš„æµ‹è¯•è¢«å®šä¹‰ä¸ºä¸€ä¸ª request + response çš„åºåˆ—

RESTler äº§ç”Ÿåºåˆ—çš„æ–¹å¼ï¼š

1. æ ¹æ® REST API çš„ Swagger è¯´æ˜ï¼Œæ¨æ–­ request ä¹‹é—´çš„ä¾èµ–
   * request A çš„ response ä¸­çš„æ•°æ®ä¼šè¢« request B ä½¿ç”¨
2. åˆ†ææµ‹è¯•æ‰§è¡Œä¸­çš„åŠ¨æ€åé¦ˆï¼Œç”¨äºäº§ç”Ÿæ–°çš„æµ‹è¯•
   * åœ¨ request A ä¹‹åæ‰§è¡Œ request B è¢«æœåŠ¡å™¨æ‹’ç»ï¼Œåˆ™é˜²æ­¢äº§ç”Ÿè¿™ç±»æµ‹è¯•

æä¾›äº†è¯æ®ï¼Œè¯æ˜äº†è¿™ä¸¤ä¸ªæŠ€æœ¯çš„å¿…è¦æ€§

RESTler è¿˜å®ç°å‡ ç§ __æœç´¢ç­–ç•¥__

å¹¶æ¯”è¾ƒäº†å®ƒä»¬åœ¨ fuzzing GitLab REST API æ—¶çš„æ•ˆæœ

æœ¬æ–‡çš„ä¸»è¦è´¡çŒ®ï¼š

* RESTler - ç¬¬ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„ REST API fuzzing å·¥å…·
* ç”¨å®éªŒè¯æ®è¡¨æ˜ RESTler ä¸­çš„æŠ€æœ¯æ˜¯å¿…ä¸å¯å°‘çš„
* è®¨è®ºäº†åœ¨å·¨å¤§çš„ request åºåˆ—çš„æœç´¢ç©ºé—´ä¸­çš„ä¸‰ç§æœç´¢ç­–ç•¥
* å…³äº GitLab çš„æ¡ˆä¾‹ç»†èŠ‚
* ä½¿ç”¨ RESTler å…³äºä¸€äº›å¾®è½¯äº‘æœåŠ¡çš„æµ‹è¯•

---

## Processing API Specifications

å®¢æˆ·ç«¯ç¨‹åºå‘é€æ¶ˆæ¯ - request

æœåŠ¡è¿”å›çš„æ¶ˆæ¯ - response

æ¶ˆæ¯ä¼ è¾“äº HTTP åè®®ä¸Š

__Swagger__ æ ‡å‡†ç”¨äºæè¿°å¦‚ä½•é€šè¿‡ REST API è®¿é—®æœåŠ¡ï¼š

* æœåŠ¡å¯ä»¥å¤„ç†ä»€ä¹ˆæ ·çš„è¯·æ±‚
* å®¢æˆ·ç«¯æœŸæœ›å¾—åˆ°ä»€ä¹ˆæ ·çš„å“åº”

> https://swagger.io/
>
> ä¹Ÿç§°ä¸º OpenAPI æ ‡å‡†
>
> ç›®å‰æœ‰ 2.0 æ ‡å‡†å’Œ 3.0 æ ‡å‡†
>
> https://swagger.io/specification/v2
>
> https://swagger.io/specification/
>
> è¿™ç¯‡è®ºæ–‡ä¸­ä½¿ç”¨çš„æ˜¯ 2.0 ç‰ˆæœ¬
>
> å®šä¹‰äº† REST API ä¸­å¿…è¦å‚æ•°çš„ JSON æ ¼å¼ (æˆ– YAML)

å¼€æºçš„ Swagger å·¥å…·å¯ä»¥è‡ªåŠ¨æ ¹æ® Swagger æè¿°æ–‡ä»¶

äº§ç”Ÿä¸€ä¸ª web UIï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿé€šè¿‡ web-UI è¡¨å•è¿›è¡Œäº¤äº’

API ä¸­å¯ä»¥åŒ…å«å¾ˆå¤šç§ __è¯·æ±‚ç±»å‹__ï¼Œå³ request type:

* GET
* POST
* DELETE
* PUT
* ...

ç”¨äºå®ç°å¯¹åº”çš„ CRUD æ“ä½œ

æœ¬æ–‡ç»™å‡ºçš„ä¾‹å­ï¼š

> è®ºæ–‡ä¸­ç»™å‡ºçš„æ˜¯ YAML æ ¼å¼
>
> æˆ‘æ›´å–œæ¬¢çœ‹ JSONï¼Œæ‰€ä»¥ç¿»è¯‘äº†ä¸€ä¸‹

```json
{
    "basePath": "/api",
    "swagger": "2.0",
    "definitions": {
        "Blog Post": {
            "properties": {
                "body": {
                    "type": "string"
                },
                "id": {
                    "type": "integer"
                }
            },
            "required": [
                "body"
            ],
            "type": "object"
        }
    },
    "paths": {
        "/blog/posts": {
            "post": {
                "parameters": [
                    {
                        "in": "body",
                        "name": "payload",
                        "required": true
                    }
                ],
                "schema": {
                    "ref": "/definitions/Blog Post"
                }
            }
        }
    }
}
```

å¤§è‡´çš„å«ä¹‰ï¼š

å®šä¹‰äº† API æ»¡è¶³çš„ Swagger ç‰ˆæœ¬ä¸º 2.0

å®šä¹‰äº† `Blog Post` å¯¹è±¡ï¼Œä»¥åŠå…¶ä¸­çš„å­—æ®µç±»å‹ï¼Œä»¥åŠå…¶ä¸­çš„å¿…å¤‡å­—æ®µ

ç„¶åå®šä¹‰äº† API çš„è·¯å¾„ - `/api/blog/posts`

å®šä¹‰äº† API è¯·æ±‚çš„æ ¼å¼ä¸º POST

å®šä¹‰äº† API è¯·æ±‚çš„å‚æ•°

* `in` è¡¨ç¤ºè¯·æ±‚å‚æ•°ä½äº `body` ä¸­ - å¯ä»¥ä¸º `query`ã€`header`ã€`path` ç­‰
* å¦‚æœæŒ‡å®šäº†å‚æ•°ä½äº `body` ä¸­ï¼Œåˆ™å¤–éƒ¨éœ€è¦æŒ‡å®šå‚æ•°ç±»å‹çš„ `schema`
  * è¿™é‡Œçš„ `schema` åˆå¼•ç”¨äº† `Blog Post` å¯¹è±¡
  * ä»£è¡¨å‚æ•°æ˜¯ä¸€ä¸ª `Blog Post` å¯¹è±¡

æ ¹æ®è¿™ä¸€ä¸ª API æè¿°

RESTler è‡ªåŠ¨æ„é€ å‡ºç”¨äºäº§ç”Ÿæµ‹è¯•çš„ä»£ç ï¼š

```python
from restler import requests
from restler import dependencies

def parse_posts(data):
    post_id = data["id"]
    dependencies.set_var(post_id)
    
request = requests.Request(
    restler_static("POST"),
    restler_static("/api/blog/posts"),
    restler_static("HTTP/1.1"),
    restler_static("{"),
    restler_static("body:"),
    restler_fuzzable("string"),
    restler_static("}"),
    "post_send": {
        "parser": parse_posts,
        "dependencies": [
            post_id.writer()
        ]
    }
)
```

å…¶ä¸­ï¼Œ`request` æ˜¾ç„¶ç”¨äºç”Ÿæˆè¯·æ±‚ï¼š

* `restler_static` - ç›´æ¥å°†åé¢çš„å­—ç¬¦ä¸²æ‹¼æ¥åˆ°è¯·æ±‚ä¸­
* `restler_fuzzable` - ä»å¯¹åº”æ•°æ®ç±»å‹çš„ __å­—å…¸__ ä¸­é€‰æ‹©çš„ä¸€ä¸ªå€¼

æ ¹æ® response çš„æ ¼å¼ï¼Œä¸€èˆ¬ä¼šè¿”å›ä¸€ä¸ªæ–°çš„åŠ¨æ€å¯¹è±¡

æ ¹æ®å¯¹è±¡çš„æ ¼å¼ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆå¤„ç†å‡½æ•° - `parse_posts`

* æŠŠå…¶ä¸­çš„ `id` å–å‡º
* ç”¨äºä¹‹åçš„ producer-consumer ä¾èµ–

---

## Test Generation Algorithm

![algorithm](../../img/restler-algorithm.png)

ä» Line-3 å¼€å§‹ï¼š

é¦–å…ˆï¼Œå°† Swagger æè¿°æ–‡ä»¶ä¸­çš„æ‰€æœ‰è¯·æ±‚æå–å‡ºæ¥

```python
reqSet = PROCESS(swagger_spec)
```

`reqSet` å°†åŒ…å« API ä¸­å®šä¹‰çš„æ‰€æœ‰è¯·æ±‚ï¼Œä»¥åŠè¯·æ±‚çš„ä¾èµ–

åˆå§‹åŒ–è¯·æ±‚åºåˆ—é›†åˆ `seqSet` ä¸ºç©º (Line-5)

ä¹‹åçš„å¾ªç¯ç”¨äºå¡«å…… `setSet` é›†åˆï¼š

* å½“åºåˆ—ä¸­çš„æ¯ä¸€ä¸ªè¯·æ±‚çš„ return code åˆæ³•ï¼Œåºåˆ—æ‰æ˜¯åˆæ³•çš„
* åˆæ³•å®šä¹‰ä¸º return code åœ¨ HTTP 200 æ—å†…
* å¾ªç¯ä» `n = 1` è¿­ä»£åˆ° `n = maxLength`
  * åœ¨æ¯ä¸€è½®è¿­ä»£ä¸­ï¼Œè®¡ç®—å‡ºé•¿åº¦ä¸º `n` çš„æ‰€æœ‰åˆæ³•è¯·æ±‚åºåˆ—

```python
n = 1
while (n <= maxLength):
    seqSet = EXTEND(seqSet, reqSet)
    seqSet = RENDER(reqSet)
    n = n + 1
```

æ ¹æ®ä»£ç ï¼Œè®¡ç®—è¯·æ±‚åºåˆ—åˆ†ä¸º __EXTEND__ å’Œ __RENDER__ ä¸¤ä¸ªéƒ¨åˆ†ï¼š

EXTEND è´Ÿè´£å°†é•¿åº¦ä¸º `n-1` çš„è¯·æ±‚åºåˆ—æ‰©å±•ä¸ºé•¿åº¦ä¸º `n` çš„åºåˆ—

* é€šè¿‡åœ¨æ¯ä¸ªåºåˆ—çš„æœ€åï¼Œè¿½åŠ ç¬¦åˆä¾èµ–æ¡ä»¶çš„æ¯ä¸ªè¯·æ±‚

å› æ­¤ï¼Œè¾“å…¥ä¸ºä¸Šä¸€è½®è¿­ä»£çš„è¯·æ±‚åºåˆ—é›†åˆ `seqSet`ï¼Œå’Œæ‰€æœ‰çš„è¯·æ±‚ `reqSet` - 

```python
def EXTEND(seqSet, reqSet):
    newSeqSet = {}
    for seq in seqSet:
        for req in reqSet:
            if DEPENDENCIES(seq, req):
                newSeqSet = newSeqSet + concat(seq, req)
    return newSeqSet
```

å…¶ä¸­ï¼Œ__DEPENDENCIES__ ç”¨äºæ£€æŸ¥æŒ‡å®š request çš„æ‰€æœ‰ä¾èµ–æ˜¯å¦æ»¡è¶³

* è¯¥è¯·æ±‚éœ€è¦çš„æ¯ä¸€ä¸ªåŠ¨æ€å¯¹è±¡ - `CONSUMES(req)`
* èƒ½å¤Ÿç”±ä¹‹å‰çš„ request å¯¹åº”çš„ response äº§ç”Ÿ - `PRODUCES(seq)`
* å¦‚æœæ‰€æœ‰ä¾èµ–éƒ½èƒ½æ»¡è¶³ï¼Œåˆ™é•¿åº¦ä¸º `n` çš„æ–°è¯·æ±‚åºåˆ—è¢«ä¿ç•™ä¸‹æ¥ï¼Œå¦åˆ™è¢«ä¸¢å¼ƒ

```python
def DEPENDENCIES(seq, req):
    if CONSUMES(req) âŠ† PRODUCES(seq):
        return True
    else:
        return False
```

```python
def CONSUMES(req):
    return object_types_required_in(req)
```

```python
def PRODUCES(seq):
    dynamicObjects = {}
    for req in seq:
        newObjs = objects_produced_in_response_of(req)
        dynamicObjects = dynamicObjects + newObjs
    return dynamicObjects
```

æ¥ä¸‹æ¥ï¼Œæ¯ä¸€ä¸ªè¢«æ‰©å±•åçš„è¯·æ±‚åºåˆ—ä¾æ¬¡è¢« __RENDER__ å‡½æ•°è¿›è¡Œå¤„ç†

å¯¹äºæ¯ä¸€ä¸ªè¯·æ±‚åºåˆ—ï¼š

* å–å¾—æœ€åä¸€ä¸ªè¯·æ±‚ (å³åˆšè¢«æ‰©å±•è¿›åºåˆ—çš„è¯·æ±‚)
* è®¡ç®—è¯·æ±‚ä¸­æ‰€æœ‰å¯è¢« fuzz çš„åŸå§‹æ•°æ®ç±»å‹
* æ¯ä¸ªå¯è¢« fuzz çš„å˜é‡è¢«å­—å…¸ä¸­å¯¹åº”æ•°æ®ç±»å‹çš„æ•°æ®å®ä¾‹åŒ–

æ‰§è¡Œè¿™ä¸ª HTTP è¯­æ³•æ­£ç¡®çš„è¯·æ±‚åºåˆ—

* ä¾æ¬¡æ‰§è¡Œåºåˆ—ä¸­çš„æ¯ä¸€ä¸ªè¯·æ±‚
* æ£€æµ‹æ¯ä¸ª request å¯¹åº”çš„ response æ˜¯å¦åˆæ³•
* æå–å¹¶ä¿ç•™æ¯ä¸ª response ä¸­çš„åŠ¨æ€å¯¹è±¡
* å¦‚æœåˆæ³•ï¼Œåˆ™è¯¥åºåˆ—è¢«ä¿ç•™

```python
def RENDER(seqSet):
    newSeqSet = {}
    for seq in seqSet:
        req = last_request_in(seq)
        V = tuple_of_fuzzable_types_in(req)
        for v in V:
            newReq = concretize(req, v)
            newSeq = concat(seq, newReq)
            response = EXECUTE(newSeq)
            if response has a valid code:
                newSeqSet = newSeqSet + newSeq
            else:
                log error
    return newSeqSet
```

ç‰¹æ®Šå¤„ç†ï¼š

* å¦‚æœ response åŒ…å«å¤šä¸ªåŠ¨æ€å¯¹è±¡
  * EXECUTE å°†ä¼šè®°å½•æ‰€æœ‰å¯¹è±¡
  * ä½†ä¼šæŒ‰é¡ºåºæä¾›ç»™ä¹‹åçš„ request
  * å³ï¼Œä¸ä¼šå°è¯•ä¸åŒé¡ºåºçš„åŠ¨æ€å¯¹è±¡
* å¦‚æœåŠ¨æ€å¯¹è±¡åœ¨è¢«ä¼ é€’ç»™ä¸€ä¸ª request ä¹‹åå¤±æ•ˆ
  * æ£€æµ‹æ¥å—åˆ°çš„ return code ä¸åœ¨ 200 èŒƒå›´å†…
  * ä¸¢å¼ƒè¯·æ±‚åºåˆ—

é»˜è®¤æƒ…å†µä¸‹ï¼ŒRENDER ä¼šä¸ºæ¯ä¸€ä¸ª request äº§ç”Ÿæ‰€æœ‰å¯èƒ½çš„ç»„åˆ

å¯¹äºå­—å…¸è¾ƒå¤§çš„æƒ…å†µï¼Œä¼šå¯¼è‡´ç»„åˆæ•°é‡çš„çˆ†ç‚¸

* ä¸€ç§å¯é€‰çš„æ–¹æ³•æ˜¯ï¼Œä»å­—å…¸ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªå€¼

åœ¨æ¯ä¸€è½®è¿­ä»£ä¸­ï¼ŒEXTEND äº§ç”Ÿäº†æ‰€æœ‰é•¿åº¦ä¸º `n+1` çš„è¯·æ±‚åºåˆ—

* æ˜¾ç„¶ï¼Œç®—æ³•æ˜¯å¹¿åº¦ä¼˜å…ˆçš„ - BFS

åœ¨ä¹‹åçš„å¯¹æ¯”å®éªŒä¸­ï¼Œè¿˜å°è¯•äº†å¦å¤–ä¸¤ç§ç­–ç•¥ï¼š

* BFS-Fast
  * åœ¨ EXTEND ä¸­ï¼Œæ¯ä¸ªè¯·æ±‚æœ€å¤šåªèƒ½è¢«åŠ å…¥åˆ°ä¸€ä¸ªåºåˆ—ä¸Š
  * ä¼šå¯¼è‡´æ›´å°çš„ `newSeqSet`
  * è¦†ç›–äº†æ‰€æœ‰çš„ request ç±»å‹ï¼Œä½†ä¸èƒ½ä¿è¯è¦†ç›–æ‰€æœ‰åˆæ³•çš„ request sequence
  * èƒ½å¤Ÿæ¯” BFS æ·±å…¥åœ°æ›´å¿«
* Random Walk
  * åœ¨ EXTEND ä¸­ï¼Œä¸¤å±‚å¾ªç¯è¢«å–æ¶ˆï¼Œéšæœºäº§ç”Ÿä¸€ä¸ªæ»¡è¶³ä¾èµ–çš„è¯·æ±‚åºåˆ—
  * åœ¨ seqSet ä¸­ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ª seq
  * åœ¨ reqSet ä¸­ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ª req
  * ç»„åˆï¼Œç›´åˆ°ä¾èµ–å¯ä»¥è¢«æ»¡è¶³
  * å½“å½“å‰è¯·æ±‚åºåˆ—æ— æ³•å†è¢«æ‰©å±•æ—¶ï¼Œä»ç©ºçš„è¯·æ±‚åºåˆ—é‡æ–°å¼€å§‹
  * æ¯” BFS å’Œ BFS-Fast æ·±å…¥æ›´å¿«

---

## Implementation

ç³»ç»Ÿæ¨¡å—ï¼š

* The parser and compiler module
  * å°† Swagger è¯´æ˜è¿›è¡Œè½¬åŒ–ï¼Œäº§ç”Ÿ RESTler è¯­æ³•çš„ fuzzing è¯´æ˜
* The core fuzzing runtime module
  * å®ç°ä¸Šè¿°ç®—æ³•åŠå…¶å˜ç§
* The garbage collector (GC) module

### A. Using RESTler

RESTler æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œè¾“å…¥åŒ…å«ï¼š

* Swagger è¯´æ˜
* æœåŠ¡è®¿é—®å‚æ•°- IPã€portã€è®¤è¯ä¿¡æ¯ç­‰
* å­—å…¸
* æœç´¢ç­–ç•¥ (BFS / BFS-Fast / Random Walk)

åœ¨æœç´¢è¿‡ç¨‹ä¸­ï¼ŒRESTler ä»¥ HTTP status code 500 ä½œä¸ºæŠ¥å‘Š bug çš„ä¾æ®

### B. Current Limitations

ä¸æ”¯æŒæœåŠ¡ç«¯é‡å®šå‘çš„ API (HTTP status code 301, 303, 307)

åªèƒ½å‘ç°å¯ä»¥é€šè¿‡ HTTP çŠ¶æ€ç è¡¨ç°å‡ºæ¥çš„ bug

---

## Evaluation

ä¸‰ä¸ªé—®é¢˜ï¼š

1. __ä¾èµ–æ¨æ–­__ å’Œ __åˆ†æåŠ¨æ€åé¦ˆ__ æ˜¯æœ‰æ•ˆ fuzzing çš„å¿…éœ€æŠ€æœ¯å—ï¼Ÿ
2. å½“è¯·æ±‚åºåˆ—çš„é•¿åº¦å¢åŠ æ—¶ï¼ŒRESTler èƒ½å¦æµ‹è¯•åˆ°æ›´æ·±çš„æœåŠ¡ç«¯é€»è¾‘ï¼Ÿ
3. åœ¨ä¸åŒçš„ API ä¸­ï¼Œä¸‰ç§æœç´¢ç­–ç•¥çš„æ¯”è¾ƒï¼Ÿ

### A. Experimental Setup

#### Blog Posts Service

å°å‹çš„ REST API

åŒ…å«äº”ç§è¯·æ±‚ç±»å‹ï¼š

* `GET` - `/posts:` - è¿”å›æ‰€æœ‰çš„åšæ–‡
* `POST` - `/posts:` - æ¨é€æ–°çš„åšæ–‡
* `DELETE` - `/posts/id:` - åˆ é™¤æŒ‡å®šçš„ä¸€ç¯‡åšæ–‡
* `GET` - `/posts/id:` - è¿”å›æŒ‡å®šçš„ä¸€ç¯‡åšæ–‡çš„å†…å®¹å’Œ checksum
* `PUT` - `/posts/id:` - æ›´æ–°åšæ–‡å†…å®¹ (éœ€è¦æäº¤æ–°åšæ–‡çš„å†…å®¹å’Œæ—§åšæ–‡çš„ checksum)

ä¸ºäº†è¡¨ç¤ºä¸€ç§æƒ³è±¡ä¸­çš„ bug

* å½“æ¯æ¬¡æ›´æ–°åšæ–‡æ—¶ï¼Œå¦‚æœæäº¤çš„ checksum å’Œè®°å½•çš„ checksum ç›¸åŒï¼Œåˆ™è§¦å‘æœªæ•è·å¼‚å¸¸
* è¿™ä¸ª bug åªä¼šåœ¨åŠ¨æ€å¯¹è±¡åœ¨è¯·æ±‚ä¹‹é—´è¢«ä¼ é€’æ—¶è§¦å‘ (å…ˆå–å¾— checksumï¼Œå†æäº¤)

#### GitLab

GitLab çš„åç«¯ä½¿ç”¨ 376K è¡Œ Ruby ä»£ç ï¼Œå…·ä½“é…ç½®ç•¥

#### Fuzzing Dictionaries

* string - "sampleString", ""
* integer - "0", "1"
* boolean - "true", "false"

### B. Techniques for Effective REST API Fuzzing

1. Inferring dependencies among request types
2. Analyzing dynamic feedback

æ˜¯å¦æ˜¯ fuzzing REST API æ‰€å¿…é¡»çš„

è¡¡é‡æŒ‡æ ‡ï¼š

1. æœåŠ¡ç«¯ code coverage
2. å®¢æˆ·ç«¯å¯è§çš„ HTTP status code

å°†äº§ç”Ÿçš„è¯·æ±‚åºåˆ—çš„é•¿åº¦æœ€å¤§å€¼è®¾å®šä¸º 3

æ¯”è¾ƒä¸€ä¸‹ä¸‰ç§æµ‹è¯•äº§ç”Ÿç®—æ³•ï¼š

1. å¿½è§† request ä¹‹é—´çš„ä¾èµ–ï¼Œå°† `id`ã€`checksum` ç­‰ä½œä¸º fuzz å¯¹è±¡éšæœºç”Ÿæˆï¼Œä½†ä¾æ—§åˆ†æåŠ¨æ€åé¦ˆ
2. å¿½è§†æœåŠ¡ç«¯çš„åŠ¨æ€åé¦ˆï¼Œä¸æ¶ˆé™¤æœç´¢è¿‡ç¨‹ä¸­äº§ç”Ÿçš„éæ³•åºåˆ—ï¼Œä½†ä¾æ—§æ¨æ–­ request ä¹‹é—´çš„ä¾èµ–
3. åŒæ—¶ä½¿ç”¨äº†ä¸¤ç§æŠ€æœ¯

![restler-tech](../../img/restler-tech.png)

å·¦ã€ä¸­ã€å³ä¸‰åˆ—åˆ†åˆ«å¯¹åº” 1ã€2ã€3

#### Code Coverage

å¯¹äº `1` æ¥è¯´ï¼Œéšç€è¯·æ±‚åºåˆ—é•¿åº¦çš„å¢åŠ ï¼Œcoverage ä¹Ÿæ²¡æœ‰æå‡

å› ä¸ºä»å­—å…¸ä¸­å®åœ¨æ˜¯æ— æ³•å¾—å‡º request ä¹‹é—´çš„ä¾èµ–

ç›¸æ¯”ä¹‹ä¸‹ï¼Œé€šè¿‡æ¨æ–­ request ä¹‹é—´ä¾èµ–çš„æŠ€æœ¯ï¼Œæå‡äº† code coverage

å¯¹äº `2` æ¥è¯´ï¼Œæ²¡æœ‰è€ƒè™‘æœåŠ¡ç«¯çš„åŠ¨æ€åé¦ˆ

å¯¹æœç´¢ç©ºé—´è¿›è¡Œå‰ªæï¼Œè¿‡æ»¤éæ³•çš„è¯·æ±‚åºåˆ—

å› æ­¤éœ€è¦èŠ±è´¹å¤§é‡çš„æ—¶é—´ï¼Œäº§ç”Ÿå¤§é‡çš„æµ‹è¯•ç”¨ä¾‹

è€Œè€ƒè™‘åŠ¨æ€åé¦ˆï¼Œåªéœ€è¦ç”¨å°‘é‡æ—¶é—´ã€å°‘é‡ç”¨ä¾‹ï¼Œå°±èƒ½å¾—åˆ°ç›¸åŒçš„ code coverage

#### HTTP Status Code

å½“å¿½ç•¥åŠ¨æ€åé¦ˆæ—¶ï¼Œå°†ä¼šå¾—åˆ°å¤§é‡çš„ `40X` response - å¤§é‡éæ³•çš„è¯·æ±‚åºåˆ—

ç›¸æ¯”ä¹‹ä¸‹ï¼Œå½“è€ƒè™‘åŠ¨æ€åé¦ˆæ—¶ï¼Œéæ³• response ä» 60% ä¸‹é™åˆ° 20%

æ­¤å¤–ï¼Œå½“å¼•å…¥äº† request ä¹‹é—´çš„ä¾èµ–æ¨æ–­æ—¶ï¼Œæœ‰ç€æœ€é«˜ç™¾åˆ†æ¯”çš„ `20X` çŠ¶æ€ç 

å½“å¿½ç•¥ä¾èµ–æ¨æ–­æ—¶ï¼Œæ²¡æœ‰ä»»ä½• `500` çš„çŠ¶æ€ç è¢«è¿”å›

* å› ä¸ºæ ¹æ®å®éªŒè®¾å®šï¼Œ`HTTP 500` çš„é”™è¯¯åªæœ‰åœ¨ request ä¹‹é—´ä¼ é€’ä¾èµ–åæ‰ä¼šè§¦å‘
* æ­¤å¤–ï¼Œå½“ä½¿ç”¨äº†åŠ¨æ€åé¦ˆçš„åˆ†æï¼Œèƒ½å¤Ÿå¯¹æœç´¢ç©ºé—´è¿›è¡Œå‰ªæï¼Œä»è€Œåœ¨æœ€å°‘çš„ç”¨ä¾‹ä¸‹è§¦å‘ bug

å®éªŒæ•´ä½“ä¸Šè¯æ˜ï¼Œ__ä¾èµ–æ¨æ–­__ å’Œ __åé¦ˆåˆ†æ__ éƒ½æ˜¯æœ‰æ•ˆ fuzzing å¿…é¡»çš„æŠ€æœ¯

### C. Deeper Service Exploration

ä½¿ç”¨ GitLab æ¥æµ‹è¯•æ›´é•¿çš„è¯·æ±‚åºåˆ—æ˜¯å¦æ„å‘³ç€æ›´æ·±çš„æœåŠ¡é€»è¾‘

![restler-gitlab](../../img/restler-gitlab.png)

å…­ç»„ APIï¼ŒBFS æœç´¢ç­–ç•¥ï¼Œäº”å°æ—¶ fuzzing æ—¶é—´ï¼Œæ¯ä¸ªè¯·æ±‚æœ€å¤š 1000 ç§ç»„åˆ

#### Code Coverage

æ›´é•¿çš„è¯·æ±‚åºåˆ—å¯¹åº”äº†æ›´é«˜çš„ code coverage

* è¿™ä¸å¥‡æ€ªï¼Œå› ä¸ºæœ‰ä¸€äº›é€»è¾‘å¿…é¡»ç”±å‡ æ¬¡è¯·æ±‚æ‰èƒ½å®Œæˆ

æ¯”å¦‚ - select a commit - éœ€è¦ project-id + commit-id

å¯¹åº”çš„ request åºåˆ—ï¼š

1. åˆ›å»ºä¸€ä¸ª project
2. ä½¿ç”¨å¯¹åº”çš„ project-id å‘é€ commit
3. ä½¿ç”¨ project-id + commit-id é€‰æ‹© commit

#### Tests, Sequence Sets, and Dynamic Objects

RENDER å‡½æ•°æ‰§è¡Œä¹‹åï¼Œæ‰§è¡Œæµ‹è¯•ç‚¹çš„æ•°é‡ã€è¯·æ±‚åºåˆ—é›†åˆçš„å¤§å°

å¦‚æœæ²¡æœ‰åŠ¨æ€åé¦ˆå‰ªæï¼ŒBFS çš„æœç´¢ç©ºé—´å°†ä¼šçˆ†ç‚¸

### D. Search Strategies

![restler-search-strategies](../../img/restler-search-strategies.png)

#### BFS vs BFS-fast

BFS åœ¨ request è¾ƒå¤šæ—¶è¾ƒå¼±

BFS-Fast åœ¨ request è¾ƒå¤šæ—¶æ•ˆæœè¾ƒå¥½

* å› ä¸ºå®ƒä¸ä¼šæœç´¢æ‰€æœ‰çš„è¯·æ±‚åºåˆ—
* è€Œæ˜¯åœ¨æ¯ä¸€è½®çš„ç”Ÿæˆä¸­ï¼Œæœ€å¤šé™„åŠ åœ¨ä¸€ä¸ªåºåˆ—ä¹‹å

å› æ­¤ BFS-Fast æœ‰ç€æ›´å°‘çš„ `seqSet`

èƒ½å¤Ÿæ›´å¿«é€Ÿåœ°æ·±å…¥åºåˆ—

#### BFS vs Random Walk

Random Walk ç­–ç•¥ä¸èƒ½ä¿è¯å…¨è¯­æ³•è¦†ç›–

å› æ­¤åœ¨ä»»ä½•æ—¶å€™éƒ½ç»´æŠ¤ç€è¾ƒå°çš„ `seqSet`

ç”±äºæœç´¢å¹¿åº¦æœ€å°ï¼Œæ·±å…¥æ›´å¿«ï¼Œä½†æœ‰å¾ˆå¤§æ¦‚ç‡éœ€è¦é‡å¤´å†æ¥

æ€»ä½“æ¥è¯´ï¼Œæœ€å¤§åŒ– code coverage æ˜¯ä¸ºäº†å¯å‘å¼åœ°æ¥è¿‘å¯»æ‰¾ bug çš„ç›®æ ‡

### E. Bug Bucketization

å®šä¹‰ HTTP `500` çŠ¶æ€ç ä¸ºå‘ç° bug çš„æ ‡å¿—

ä½†å¤šä¸ª bug å¯èƒ½æ˜¯åŒä¸€ä¸ª bug çš„å¤šä¸ªå®ä¾‹

å½“ bug è¢«å‘ç°æ—¶ï¼š

* è®¡ç®—å…¶æ‰€æœ‰æœªæ¸²æŸ“è¯·æ±‚åºåˆ—çš„æ‰€æœ‰éç©ºå‰ç¼€
* æ£€æŸ¥å‰ç¼€æ˜¯å¦å·²ç»è¢«è®°å½•
* å¦‚æœåŒ¹é…ï¼Œåˆ™å½’ä¸ºåŒä¸€ç±»

---

## Summary

å…¶ä½™éƒ¨åˆ†ä¼¼ä¹æ²¡å•¥ç”¨äº†

ä¸å¤ªå¥½è¯„ä»·è¿™ç¯‡è®ºæ–‡

æŸ¥äº†ä¸€ä¸‹å¥½åƒæ˜¯è½¯ä»¶å·¥ç¨‹çš„é¡¶çº§ä¼šè®®ï¼Ÿ

æœ¬æ¥è§‰å¾—å¾ˆæœ‰æ„æ€ï¼Œä½†æƒ³è¯»æºç å´æ²¡æœ‰

æ„Ÿè§‰å’Œä¿¡æ¯å®‰å…¨å››å¤§é¡¶ä¼šçš„è®ºæ–‡ç›¸æ¯”

è®ºæ–‡çš„å™è¿°é€»è¾‘ä¸Šæ²¡æœ‰é‚£ä¹ˆçš„é€šé¡º ğŸ¤”

è®²å¾—æ¯”è¾ƒæŠ½è±¡çš„åœ°æ–¹åˆæ²¡æœ‰ä¾‹å­

Fine. æ²¡æœ‰ä¾‹å­æ²¡æœ‰æºç æˆ‘çœ‹ä¸ªå¥¶å­ï¼Ÿ

---

